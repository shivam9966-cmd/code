import os
import psycopg2

CSV_PATH = r"C:\path\to\your_file.csv"   # <-- change this
DB_HOST = "localhost"
DB_PORT = 5432
DB_NAME = "postgres"
DB_USER = "postgres"
DB_PASSWORD = "YOUR_PASSWORD"           # <-- change this

def main():
    if not os.path.exists(CSV_PATH):
        raise FileNotFoundError(f"CSV not found: {CSV_PATH}")

    conn = psycopg2.connect(
        host=DB_HOST,
        port=DB_PORT,
        dbname=DB_NAME,
        user=DB_USER,
        password=DB_PASSWORD,
    )

    try:
        with conn.cursor() as cur:
            with open(CSV_PATH, "r", encoding="utf-8-sig", newline="") as f:
                cur.copy_expert(
                    """
                    COPY "AI-ML"."Forecasting Data"
                    FROM STDIN
                    WITH (
                        FORMAT CSV,
                        HEADER TRUE,
                        DELIMITER ',',
                        QUOTE '"',
                        ESCAPE '"'
                    )
                    """,
                    f
                )

        conn.commit()
        print('CSV uploaded into "AI-ML"."Forecasting Data" ✅')

    except Exception as e:
        conn.rollback()
        print("❌ Upload failed. Rolled back transaction.")
        raise e

    finally:
        conn.close()


if __name__ == "__main__":
    main()
