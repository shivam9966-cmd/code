from pyspark.sql import functions as F

# Extract actual + forecasted months from SCENARIO like F1_11
granular = (
    granular
    .withColumn(
        "actual_months",
        F.regexp_extract("scenario", r"F(\d+)_\d+", 1).cast("int")
    )
    .withColumn(
        "forecasted_months",
        F.regexp_extract("scenario", r"F\d+_(\d+)", 1).cast("int")
    )
)

# Replace nulls with 0
granular = granular.fillna({
    "actual_months": 0,
    "forecasted_months": 0
})
