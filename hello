from fastapi import FastAPI
from pydantic import BaseModel
import pandas as pd
from business_summary_engine import generate_full_business_summary

# Create the FastAPI app
app = FastAPI()

# Load your dataset once when the server starts
df = pd.read_csv("kpi_data_smallcasecols_copy.csv")


# The frontend will send these 4 filters in a JSON request
class FilterRequest(BaseModel):
    year: str       # e.g., "FY25"
    month: int      # 1-12
    version: str    # "L6" or "L7"
    scenario: str   # "Actual", "Plan", etc.


# Endpoint: POST /business-summary
@app.post("/business-summary")
def business_summary(filters: FilterRequest):
    result = generate_full_business_summary(
        df=df,
        year=filters.year,
        month=filters.month,
        version=filters.version,
        scenario=filters.scenario
    )
    return result
