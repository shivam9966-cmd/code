from pyspark.sql import functions as F

df_clean = df_filtered

for old, new in rename_map.items():
    if old in df_clean.columns:
        df_clean = df_clean.withColumnRenamed(old, new)

# Ensure date becomes actual date type
df_clean = df_clean.withColumn("date", F.to_date("date"))

# Ensure nulls replaced for actual & forecasted
df_clean = df_clean.withColumn(
    "actual_months", F.coalesce("actual_months", F.lit(0))
)

df_clean = df_clean.withColumn(
    "forecasted_months", F.coalesce("forecasted_months", F.lit(0))
)

df_clean.show(20)
